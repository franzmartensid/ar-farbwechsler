<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>AR Farbwechsler + Rotation + Verschieben + Skalierung + Texturen + Helligkeit</title>
<script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.js"></script>

<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body { margin: 0; overflow: hidden; }

  #instructions {
    position: absolute;
    top: 10px;
    left: 50%;
    transform: translateX(-50%);
    color: white;
    font-family: sans-serif;
    background: rgba(0,0,0,0.7);
    padding: 12px 20px;
    border-radius: 10px;
    text-align: center;
    z-index: 9999;
    cursor: pointer;
    font-size: 1.1em;
  }

  .button-group {
    position: absolute;
    top: 60px;
    display: flex;
    flex-direction: column;
    gap: 4px;
    z-index: 1000;
  }

  .button-group.left { left: 10px; }
  .button-group.right { right: 10px; }

  button {
    padding: 8px 12px;
    border-radius: 5px;
    border: none;
    cursor: pointer;
    font-weight: bold;
    color: white;
    font-size: 0.8em;
  }

  .color-button { background: gray; }
  .rotate-button { background: black; }
  .move-button { background: teal; }
  .scale-button { background: purple; }
  .texture-button { background: brown; }
  .light-button { background: orange; }

  button.flash {
    animation: flash 0.2s ease;
  }

  @keyframes flash {
    0% { transform: scale(1); box-shadow: 0 0 3px white; }
    50% { transform: scale(1.1); box-shadow: 0 0 15px white; }
    100% { transform: scale(1); box-shadow: 0 0 3px white; }
  }
</style>
</head>
<body>

<div id="instructions">Tippe hier, um die Kamera zu aktivieren und AR zu starten</div>

<div class="button-group left">
  <button class="color-button" style="background:#ff0000" data-color="#ff0000">Rot</button>
  <button class="color-button" style="background:#00ff00" data-color="#00ff00">Gr√ºn</button>
  <button class="color-button" style="background:#0000ff" data-color="#0000ff">Blau</button>
  <button class="texture-button" data-texture="wood">üå≥ Holz</button>
  <button class="texture-button" data-texture="metal">‚öôÔ∏è Metall</button>
  <button class="texture-button" data-texture="stone">ü™® Stein</button>
</div>

<div class="button-group right">
  <button class="rotate-button" data-rotate="15">‚ü≥ Rechts</button>
  <button class="rotate-button" data-rotate="-15">‚ü≤ Links</button>
  <button class="move-button" data-move="forward">‚Üë Vor</button>
  <button class="move-button" data-move="backward">‚Üì Zur√ºck</button>
  <button class="move-button" data-move="left">‚Üê Links</button>
  <button class="move-button" data-move="right">‚Üí Rechts</button>
  <button class="scale-button" data-scale="up">‚ûï Gr√∂√üer</button>
  <button class="scale-button" data-scale="down">‚ûñ Kleiner</button>
  <button class="light-button" data-action="increase">üí° Heller</button>
  <button class="light-button" data-action="decrease">üí° Dunkler</button>
</div>

<a-scene id="ar-scene" embedded vr-mode-ui="enabled: false" style="display:none"
         arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false;">
  <a-marker preset="hiro" smooth="true" smoothCount="10" smoothTolerance="0.01" smoothThreshold="5">
    <a-entity id="model"
      gltf-model="url(https://franzmartensid.github.io/Franz-Fridolin/board-handle.gltf)"
      scale="0.005 0.005 0.005"
      rotation="0 0 0"
      position="0 0.1 0">
    </a-entity>
    <a-light type="ambient" intensity="0.7"></a-light>
    <a-light type="directional" position="0 2 1.5" intensity="1.5"></a-light>
  </a-marker>
  <a-entity camera></a-entity>
</a-scene>

<script>
const instructions = document.getElementById('instructions');
const arScene = document.getElementById('ar-scene');
const model = document.querySelector('#model');

instructions.addEventListener('click', () => {
  instructions.style.display = 'none';
  arScene.style.display = 'block';
});

// Farbwechsel
document.querySelectorAll('.color-button').forEach(btn => {
  btn.addEventListener('click', () => {
    const color = btn.getAttribute('data-color');
    model.object3D.traverse(node => {
      if(node.isMesh && node.material){
        node.material.color.set(color);
      }
    });
  });
});

// Rotation
document.querySelectorAll('.rotate-button').forEach(btn => {
  btn.addEventListener('click', () => {
    const angle = parseFloat(btn.getAttribute('data-rotate'));
    const rotation = model.getAttribute('rotation');
    model.setAttribute('rotation', { x: rotation.x, y: rotation.y + angle, z: rotation.z });
  });
});

// Verschiebung
const moveDistance = 0.9;
document.querySelectorAll('.move-button').forEach(btn => {
  btn.addEventListener('click', () => {
    const dir = btn.getAttribute('data-move');
    const pos = model.getAttribute('position');
    let newPos = { ...pos };
    switch(dir){
      case 'forward': newPos.z -= moveDistance; break;
      case 'backward': newPos.z += moveDistance; break;
      case 'left': newPos.x -= moveDistance; break;
      case 'right': newPos.x += moveDistance; break;
    }
    model.setAttribute('position', newPos);
  });
});

// Skalierung
const scaleStep = 0.2;
document.querySelectorAll('.scale-button').forEach(btn => {
  btn.addEventListener('click', () => {
    const scale = model.getAttribute('scale');
    const action = btn.getAttribute('data-scale');
    let factor = action==='up'? 1+scaleStep : 1-scaleStep;
    model.setAttribute('scale', { x: scale.x*factor, y: scale.y*factor, z: scale.z*factor });
  });
});

// Textur-Wechsel
const textureBaseURL = "https://franzmartensid.github.io/Franz-Fridolin/";
document.querySelectorAll('.texture-button').forEach(btn => {
  btn.addEventListener('click', () => {
    const type = btn.getAttribute('data-texture');
    let textureURL = '';
    switch (type) {
      case 'wood': textureURL = textureBaseURL + 'oak_veneer_01_diff_4k.jpg'; break;
      case 'metal': textureURL = textureBaseURL + 'rusty_metal_04_diff_4k.jpg'; break;
      case 'stone': textureURL = textureBaseURL + 'rock_face_03_diff_4k.jpg'; break;
    }
    const loader = new THREE.TextureLoader();
    loader.load(textureURL, texture => {
      texture.wrapS = THREE.RepeatWrapping;
      texture.wrapT = THREE.RepeatWrapping;
      texture.repeat.set(1,1);
      model.object3D.traverse(node => {
        if(node.isMesh){
          node.material = new THREE.MeshStandardMaterial({
            map: texture,
            metalness:0.3,
            roughness:0.6,
            emissive: new THREE.Color(0x000000) // Start ohne zus√§tzliche Helligkeit
          });
          node.material.needsUpdate = true;
        }
      });
    });
  });
});

// Licht Heller/Dunkler √ºber emissive
const lightStep = 0.1;
document.querySelectorAll('.light-button').forEach(btn => {
  btn.addEventListener('click', () => {
    const action = btn.getAttribute('data-action');
    model.object3D.traverse(node => {
      if(node.isMesh && node.material){
        if(!node.material.emissive) node.material.emissive = new THREE.Color(0x000000);
        let hsl = {};
        node.material.emissive.getHSL(hsl);
        hsl.l += (action==='increase'? lightStep : -lightStep);
        hsl.l = Math.min(1, Math.max(0, hsl.l));
        node.material.emissive.setHSL(hsl.h, hsl.s, hsl.l);
        node.material.needsUpdate = true;
      }
    });
  });
});

// Button-Tap-Animation
document.querySelectorAll('button').forEach(btn => {
  btn.addEventListener('click', () => {
    btn.classList.add('flash');
    setTimeout(() => btn.classList.remove('flash'), 200);
  });
});
</script>

</body>
</html>
