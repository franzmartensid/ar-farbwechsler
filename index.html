<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>AR Farbwechsler + Rotation + Verschieben + Skalierung + Texturen</title>
<script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
<script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.js"></script>

<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  body { margin: 0; overflow: hidden; }
  #instructions {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: white;
    font-family: sans-serif;
    background: rgba(0,0,0,0.7);
    padding: 20px 30px;
    border-radius: 10px;
    text-align: center;
    z-index: 999;
    cursor: pointer;
    font-size: 1.2em;
  }
  #button-container {
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    flex-wrap: wrap;
    gap: 5px;
    z-index: 1000;
    justify-content: center;
  }
  button {
    padding: 10px 15px;
    border-radius: 5px;
    border: none;
    cursor: pointer;
    font-weight: bold;
    color: white;
  }
  .color-button { background: gray; }
  .rotate-button { background: black; }
  .move-button { background: teal; }
  .scale-button { background: purple; }
  .texture-button { background: brown; }
</style>
</head>
<body>

<div id="instructions">
  Tippe hier, um die Kamera zu aktivieren und AR zu starten
</div>

<div id="button-container">
  <!-- Farbbuttons -->
  <button class="color-button" style="background:#ff0000" data-color="#ff0000">Rot</button>
  <button class="color-button" style="background:#00ff00" data-color="#00ff00">Gr√ºn</button>
  <button class="color-button" style="background:#0000ff" data-color="#0000ff">Blau</button>

  <!-- Rotationsbuttons -->
  <button class="rotate-button" data-rotate="15">‚ü≥ Rechts</button>
  <button class="rotate-button" data-rotate="-15">‚ü≤ Links</button>

  <!-- Verschiebebuttons -->
  <button class="move-button" data-move="forward">‚Üë Vor</button>
  <button class="move-button" data-move="backward">‚Üì Zur√ºck</button>
  <button class="move-button" data-move="left">‚Üê Links</button>
  <button class="move-button" data-move="right">‚Üí Rechts</button>

  <!-- Skalierungsbuttons -->
  <button class="scale-button" data-scale="up">‚ûï Gr√∂√üer</button>
  <button class="scale-button" data-scale="down">‚ûñ Kleiner</button>

  <!-- Textur-Buttons -->
  <button class="texture-button" data-texture="wood">üå≥ Holz</button>
  <button class="texture-button" data-texture="metal">‚öôÔ∏è Metall</button>
  <button class="texture-button" data-texture="stone">ü™® Stein</button>
</div>

<a-scene id="ar-scene" embedded vr-mode-ui="enabled: false" style="display:none"
         arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false;">

  <!-- Marker -->
  <a-marker preset="hiro" smooth="true" smoothCount="10" smoothTolerance="0.01" smoothThreshold="5">
    <a-entity id="model"
      gltf-model="url(https://franzmartensid.github.io/Franz-Fridolin/board-handle.gltf)"
      scale="0.005 0.005 0.005"
      rotation="0 0 0"
      position="0 0.1 0">
    </a-entity>

    <!-- Licht -->
    <a-light type="ambient" intensity="0.7"></a-light>
    <a-light type="directional" position="0 2 2" intensity="1.5"></a-light>
  </a-marker>

  <a-entity camera></a-entity>
</a-scene>

<script>
const instructions = document.getElementById('instructions');
const arScene = document.getElementById('ar-scene');
const model = document.querySelector('#model');

// Kamera starten
instructions.addEventListener('click', () => {
  instructions.style.display = 'none';
  arScene.style.display = 'block';
});

// Farbwechsel
document.querySelectorAll('.color-button').forEach(btn => {
  btn.addEventListener('click', () => {
    const color = btn.getAttribute('data-color');
    model.object3D.traverse(node => {
      if(node.isMesh && node.material){
        node.material.color.set(color);
      }
    });
  });
});

// Rotation
document.querySelectorAll('.rotate-button').forEach(btn => {
  btn.addEventListener('click', () => {
    const angle = parseFloat(btn.getAttribute('data-rotate'));
    const rotation = model.getAttribute('rotation');
    model.setAttribute('rotation', {
      x: rotation.x,
      y: rotation.y + angle,
      z: rotation.z
    });
  });
});

// Verschiebung (2D auf Marker)
const moveDistance = 0.9; // 2 cm
document.querySelectorAll('.move-button').forEach(btn => {
  btn.addEventListener('click', () => {
    const dir = btn.getAttribute('data-move');
    const pos = model.getAttribute('position');
    let newPos = { ...pos };

    switch(dir){
      case 'forward': newPos.z -= moveDistance; break;
      case 'backward': newPos.z += moveDistance; break;
      case 'left': newPos.x -= moveDistance; break;
      case 'right': newPos.x += moveDistance; break;
    }

    model.setAttribute('position', newPos);
  });
});

// Skalierung
const scaleStep = 0.2; // 1 cm pro Klick
document.querySelectorAll('.scale-button').forEach(btn => {
  btn.addEventListener('click', () => {
    const scale = model.getAttribute('scale');
    const action = btn.getAttribute('data-scale');
    let factor = 1;

    if(action === 'up') factor = 1 + scaleStep;
    if(action === 'down') factor = 1 - scaleStep;

    model.setAttribute('scale', {
      x: scale.x * factor,
      y: scale.y * factor,
      z: scale.z * factor
    });
  });
});

// üåà Textur-Wechsel mit neuem Material
const textureBaseURL = "https://franzmartensid.github.io/Franz-Fridolin/";

document.querySelectorAll('.texture-button').forEach(btn => {
  btn.addEventListener('click', () => {
    const type = btn.getAttribute('data-texture');
    let textureURL = '';

    switch (type) {
      case 'wood': textureURL = textureBaseURL + 'oak_veneer_01_diff_4k.jpg'; break;
      case 'metal': textureURL = textureBaseURL + 'rusty_metal_04_diff_4k.jpg'; break;
      case 'stone': textureURL = textureBaseURL + 'rock_face_03_diff_4k.jpg'; break;
    }

    const loader = new THREE.TextureLoader();
    loader.load(textureURL, texture => {
      texture.wrapS = THREE.RepeatWrapping;
      texture.wrapT = THREE.RepeatWrapping;
      texture.repeat.set(1, 1);

      model.object3D.traverse(node => {
        if (node.isMesh) {
          node.material = new THREE.MeshStandardMaterial({
            map: texture,
            metalness: 0.3,
            roughness: 0.6
          });
          node.material.needsUpdate = true;
        }
      });
    });
  });
});
</script>

</body>
</html>
